{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/devops/deploy-django-with-jenkins-old/",
    "result": {"data":{"site":{"siteMetadata":{"title":"logging.ohyunkyo"}},"markdownRemark":{"id":"67f66c8b-afe1-5ff4-9c6e-84043895887f","excerpt":"다음 링크의 내용을 참고하여 작성한 글입니다. https://www.dongyeon1201.kr/9026133b-31be-4b58-bcc7-49abbe893044 0. 서론 지금 온라인중인 서비스는  로만 만들어져 있다.\r\n개발 수정사항을 깃허브에 푸쉬 하면 EC…","html":"<blockquote>\n<p>다음 링크의 내용을 참고하여 작성한 글입니다.<br>\n<a href=\"https://www.dongyeon1201.kr/9026133b-31be-4b58-bcc7-49abbe893044\">https://www.dongyeon1201.kr/9026133b-31be-4b58-bcc7-49abbe893044</a></p>\n</blockquote>\n<h2>0. 서론</h2>\n<p>지금 온라인중인 서비스는 <code class=\"language-text\">django</code> 로만 만들어져 있다.\r\n개발 수정사항을 깃허브에 푸쉬 하면 EC2에서 저장소의 소스코드를 수동으로 가져와야 한다.</p>\n<p>소스코드를 리팩토링 하는 과정에서 프론트와 백엔드 구분을 위해 vue.js - drf 구조로 변경했고, 수동으로 소스코드를 가져오는 불편함을 해소하기 위해 젠킨스를 사용한 CI/CD 를 도입하기로 결정했다. 또한 백엔드는 도커 컨테이너를 통해 제공하고, 프론트는 S3 를 통해 배포하기로 결정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># 최종 목표 기술 스택 \r\n \r\nfront-end : vue.js / S3\r\nback-end : django / docker on EC2\r\ndb : rds(mysql)\r\nCI/CD : jenkins</code></pre></div>\n<p>프론트와 백엔드 구분은 이미 완료했고 이후 젠킨스를 통해 백엔드를 배포 하는 과정을 정리했다.<br>\nAWS 나 도커에 대한 기본 지식은 보유했다고 가정하고 최대한 생략할 예정이다.</p>\n<p>목표하는 전체적인 배포 프로세스는 다음과 같다.</p>\n<ol>\n<li>개발 수정사항 github master branch 에 push</li>\n<li>젠킨스를 사용하여 해당 수정사항 테스트</li>\n<li>결과를 텔레그램으로 전달</li>\n<li>테스트 성공시 docker image build</li>\n<li>build 된 이미지를 docker hub 에 업로드</li>\n<li>docker hub 의 이미지를 사용하여 컨테이너 실행</li>\n</ol>\n<blockquote>\n<p>다음 링크의 내용을 참고하여 작성한 글입니다.<br>\n<a href=\"https://www.dongyeon1201.kr/9026133b-31be-4b58-bcc7-49abbe893044\">https://www.dongyeon1201.kr/9026133b-31be-4b58-bcc7-49abbe893044</a></p>\n</blockquote>\n<h2>1. CI/CD 서버 구성</h2>\n<p>EC2 인스턴스를 하나 생성했다. 주의해야 할 점은 젠킨스에서 사용할 포트를 허용하도록 설정해야 한다는것이다.</p>\n<p>방금 만든 인스턴스를 젠킨스 서버라고 부르기로 하자</p>\n<h2>2. CI/CD 서버에 jenkins 설치<a id='2.-CI/CD-서버에-jenkins-설치'></a></h2>\n<p>젠킨스 서버에 jenkins 서비스를 올릴것이다. 젠킨스에서 제공하는 도커 이미지를 사용하면 좀 더 편하다.</p>\n<p>일단 docker 와 docker-compose 를 설치한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># docker 설치</span>\r\n\r\n$ <span class=\"token function\">sudo</span> yum update -y\r\n$ <span class=\"token function\">sudo</span> amazon-linux-extras <span class=\"token function\">install</span> -y <span class=\"token function\">docker</span> -y\r\n$ <span class=\"token function\">sudo</span> systemctl start <span class=\"token function\">docker</span>\r\n$ <span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> <span class=\"token function\">docker</span></code></pre></div>\n<p>인스턴스 재시작시 도커가 실행되도록 했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># docker-compose 설치</span>\r\n\r\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">curl</span> -SL https://github.com/docker/compose/releases/download/v2.4.1/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose\r\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">chmod</span> +x /usr/local/bin/docker-compose\r\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">ln</span> -s /usr/local/bin/docker-compose /usr/bin/docker-compose</code></pre></div>\n<p><a href=\"https://docs.docker.com/compose/install/\">docker-compose 설치</a></p>\n<p>그 다음에 젠킨스 컨테이너 생성을 위한 yml 파일을 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">mkdir</span> jenkins\r\n$ <span class=\"token function\">vi</span> jenkins/docker-compose.yml</code></pre></div>\n<p>docker-compose 에 대해 잘 모르기 때문에 일단 그대로 사용하고 넘어갔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># jenkins/docker-compose.yml</span>\r\n\r\n<span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span>\r\n\r\n<span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span>\r\n    <span class=\"token key atrule\">jenkins</span><span class=\"token punctuation\">:</span>\r\n        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jenkins/jenkins<span class=\"token punctuation\">:</span>lts\r\n        <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> jenkins_cicd\r\n        <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock\r\n            <span class=\"token punctuation\">-</span> /jenkins<span class=\"token punctuation\">:</span>/var/jenkins_home\r\n        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\r\n            <span class=\"token punctuation\">-</span> <span class=\"token string\">\"8080:8080\"</span>\r\n        <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\r\n        <span class=\"token key atrule\">user</span><span class=\"token punctuation\">:</span> root</code></pre></div>\n<p>이제 <code class=\"language-text\">docker-compose up -d</code> 명령어로 컨테이너를 생성하고 실행한다. 이렇게 하면 젠킨스 서비스가 실행된다.</p>\n<blockquote>\n<p><code class=\"language-text\">docker-compose</code> 명령어는 <code class=\"language-text\">docker-compose.yml</code> 파일이 있는곳에서 실행해야 한다.</p>\n</blockquote>\n<p>다음과 같이 브라우저에 URL 을 입력하여 젠킨스 서비스 화면을 확인해 볼 수 있다.</p>\n<blockquote>\n<p>[젠킨스 서버 IP]:8080 (ex: 10.0.0.0:8080)</p>\n</blockquote>\n<h2>3. jenkins 설정하기</h2>\n<p>처음 보는 화면에서 젠킨스는 비밀번호부터 물어본다. 비밀번호는 이미 생성된 상태인데, 다음 명령어에서 확인 가능하다</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">docker-compose</span> logs</code></pre></div>\n<blockquote>\n<p>이것도 <code class=\"language-text\">docker-compose.yml</code> 파일이 있는곳에서 명령어를 실행해야 한다. 해당 파일의 볼륨에 있는 로그를 가져오는듯</p>\n</blockquote>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/abc7a1efdcf29a734e35a5a1cc5dcf1b/fbf08/300-generated-password.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.932773109243694%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA4klEQVQY03WRS27DMAxEGYu1Y/1tyfksEjfHCHqKopvm/geZgEzcGkG7eBiBFMghSTTPoP0emxgxDAPGcUQpBeMwotaKWipyzkpK6SdvrUXbtui6TiGiJ1LwcACFAGsdvPfw7oFzTgk+aFzVeYQQwMyrImvmdy0oDqdpUpeCuFtU3ElOVNyVWhBj1GbSSN/+0YjofNaRKUZ8OIdvY/BpDL6YcWPGdduDmPHGDGOMOhOapvnH4eUCOh6xSUk7pKeuHSz7E13+aCxG9P32peDpBNrtdIc5ZT3GMvafZDlceTnEL3cv8IkI6O0SEQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"generated-password\"\n        title=\"generated-password\"\n        src=\"/static/abc7a1efdcf29a734e35a5a1cc5dcf1b/906b5/300-generated-password.png\"\n        srcset=\"/static/abc7a1efdcf29a734e35a5a1cc5dcf1b/5ea4d/300-generated-password.png 238w,\n/static/abc7a1efdcf29a734e35a5a1cc5dcf1b/466da/300-generated-password.png 475w,\n/static/abc7a1efdcf29a734e35a5a1cc5dcf1b/906b5/300-generated-password.png 950w,\n/static/abc7a1efdcf29a734e35a5a1cc5dcf1b/fbf08/300-generated-password.png 962w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이 비밀번호를 입력하고 들어가면 기본적인 설정을 해야한다. 실제로 할것은 크게 없고 다음으로 넘어가기만 하면 된다.</p>\n<h3>3.1 플러그인 설치</h3>\n<p>Install suggested plugins 을 눌러 많이 사용하는 플러그인을 자동으로 설치하도록 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/503df7ed390aed938564519afee80fd2/84f4d/310-customize-jenkins.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABoUlEQVQ4y6VTa4+iQBDc//+j9uspxmiUQ9EYwBWUh/KYGRhAqE33LXurq8k9OqnMhMnUVFc1L4ZhYLFYwPNcOK6LOI6RJMlfge7M53MQ18t4PMZ6vUbfdWjbFs+q73vGs1oulyCu34R9D8/zsFqtGJZlwXU9/LQsbDYbfux6vTK6rrsB3f0kHI1GsG2bXymVhBICpRRQUkBKAVEUkFIyIaGua1RVxetXxTeEpIDqrDQOmYKfKZyKEqlukesWhRC4XC5I0xRlWULXNeqmubHhTuEvQjvM8GofYJ5S2HEBr9Dwiwr7/R6O43AAQggopVBp/djDrwp3Z4F5kMIMM5hhjkWYw7lIJHGMKIo4zTAMeT+oJQ+/K/wgtMIMP/YxjLczjMMZo7cE1inF8XjEwfcRBEf4QQDf9xFFMfI8Z3+fKizrFvIO9K1pGvaMVmo3yzIUHJZgCyh50zS/E/5JUbqUfKkUtzzM7kOF3Udqz6C1ZkU0NoN3D0MZ5vDR0A6gM/KMWiXy+/Mbwu12i/+tTw/ph57NZtjtdgyat3/BdDrFZDLBO4qiHqSik9guAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"customize-jenkins\"\n        title=\"customize-jenkins\"\n        src=\"/static/503df7ed390aed938564519afee80fd2/906b5/310-customize-jenkins.png\"\n        srcset=\"/static/503df7ed390aed938564519afee80fd2/5ea4d/310-customize-jenkins.png 238w,\n/static/503df7ed390aed938564519afee80fd2/466da/310-customize-jenkins.png 475w,\n/static/503df7ed390aed938564519afee80fd2/906b5/310-customize-jenkins.png 950w,\n/static/503df7ed390aed938564519afee80fd2/84f4d/310-customize-jenkins.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span><br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/795ff61a4a332d4cdddb3eb79ad62136/84f4d/310-getting-started.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABkklEQVQ4y5WUCY+CMBCF9///Mo+oRWOWNZFDFKTKId4Hvs0bLYHs5ZJ8ttXp65uZ4lun08FwOITve3BdF1qvsF6v/0WSJLAsC9R6a7fbsG0bZVmiLO/47rnf7xU/PaPRCNSqBBms4xiLxQJxHCOKIiyXS5lfLhfcbreKx+FNKsFWq4XJZCKnfDgBPM/DdDrFbDaD57mYz+dfxOpr47rh8N22cb1ecbpc5UduMoHcdDwecT6fhfr8dDoJnLMPIshCDgYKQRAgCkPEWkvaWmtkWYYgmCOKQujVCuskQZqmKIpCRrLdbmWtlHo0hR9KWSLCmiXPTSTPNyJo6prlOYrNBofDoXJmaDpUCss4xqpykSHPMhTFFlPHgeM4j8PSVITzPJfU6/DaNARNV5kqhemUKbM5ptthGAqM3e124pJiHJuCg4GkxTqyq4Tz+roOY38VVE+HDHwFujSChoZgv98XN77vvwTLwM7u93uBTWq8euPxWL7kqSboL3hv2V2OjYttUuYfA3nVJd8oA/f1ej10u118AlmqEKttuSTJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"getting-started\"\n        title=\"getting-started\"\n        src=\"/static/795ff61a4a332d4cdddb3eb79ad62136/906b5/310-getting-started.png\"\n        srcset=\"/static/795ff61a4a332d4cdddb3eb79ad62136/5ea4d/310-getting-started.png 238w,\n/static/795ff61a4a332d4cdddb3eb79ad62136/466da/310-getting-started.png 475w,\n/static/795ff61a4a332d4cdddb3eb79ad62136/906b5/310-getting-started.png 950w,\n/static/795ff61a4a332d4cdddb3eb79ad62136/84f4d/310-getting-started.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>3.2 계정 생성</h3>\n<p>설치가 완료되면 계정을 생성해야 한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3f458c76c88f9fed54913ac4e797f2a8/84f4d/320-create-first-admin-user.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABGklEQVQ4y62TW2qEMBiF3f8C+twd9K0bKAOaWqyXgpcYHfrUUYsV8a6nJMXijDNxhvbAhxHjx/khUQghsCwL+32MKIqRJAnSNL2JLMtgmia4S1FVFb7v469xHAeaph0LD4cPBEEAxkJQShHHMVzXFe98HVCKYRgwTdMK27bXwqIokOe5oK5rVFUlaJpGwNf8Z56ljOeskEu6rhPIciq9KJwblWX5Kz833tUN53Zt2wph3/erJqdNpULZeJe+SYVb4/2L8Bqkwq3wLcvmwzhhPD2HnueJDfzQjuO4yTT9PI9vykLIb8ctmedIyx5a+Anz/QsvrxYI0aDwC20YBsIwFERRJIWGDF5AwRjDk/6Gu4cd7h9V7FQCXX/GN2FUKayEGaYGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create-first-admin-user\"\n        title=\"create-first-admin-user\"\n        src=\"/static/3f458c76c88f9fed54913ac4e797f2a8/906b5/320-create-first-admin-user.png\"\n        srcset=\"/static/3f458c76c88f9fed54913ac4e797f2a8/5ea4d/320-create-first-admin-user.png 238w,\n/static/3f458c76c88f9fed54913ac4e797f2a8/466da/320-create-first-admin-user.png 475w,\n/static/3f458c76c88f9fed54913ac4e797f2a8/906b5/320-create-first-admin-user.png 950w,\n/static/3f458c76c88f9fed54913ac4e797f2a8/84f4d/320-create-first-admin-user.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>3.3 URL 설정</h3>\n<p>젠킨스 url 설정하는 부분. 잘 모르는 부분이라 건들지 않고 넘겼다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/85fc839db59157227125bc8ac77c9b3d/84f4d/330-instance-configuration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABK0lEQVQ4y72Ta2uDMBSG+/8/9+vYn9j6EzbNypyXQaMVa7VQb9C1FY1pfEcEpVY7ug524CEckjw5uU0IITAMA76/guetEMcJ0jTtSJJ+PkaWZdB1HdI1URQFtm3jr2FZFlRV7QtlNTa1EQQhNpsN1mGIxXKJIAjgOA6iKGrG1XU9wDTNoXC/32O73eJ4OCDa7eDOZrCnUywoRRzHyPMcQogebYwKq6pq4FUFJslzVMcjGGNdX1mWDUVRNK2s7qpQTmwHNpNky1iXSzjnHXKBtspR4el0GsJ5Lx87v6vCtvPWuEl4D/8r/O2WhaghLt8hpbS7lMt39hPnBVjWmVD+gnuCC0Dzd9DXX3j/MECIion80JqmwXXdBs/zbuZz4eDh6RWPzwpeFIL5/A3fQZcnIh3FjjAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"instance-configuration\"\n        title=\"instance-configuration\"\n        src=\"/static/85fc839db59157227125bc8ac77c9b3d/906b5/330-instance-configuration.png\"\n        srcset=\"/static/85fc839db59157227125bc8ac77c9b3d/5ea4d/330-instance-configuration.png 238w,\n/static/85fc839db59157227125bc8ac77c9b3d/466da/330-instance-configuration.png 475w,\n/static/85fc839db59157227125bc8ac77c9b3d/906b5/330-instance-configuration.png 950w,\n/static/85fc839db59157227125bc8ac77c9b3d/84f4d/330-instance-configuration.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>3.4 완료</h3>\n<p>완료되었다!!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6f752f66da458bdfe62dd9fd7e3af2a9/84f4d/340-jenkins-is-ready.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA9UlEQVQ4y62UXQuCMBSG+/9/or/SpR+I+JHozHRFETivNG+avrElYlMrqxdexjbOcw7b2VaGYcB1XVCaIU1T5HkOxtgiF0UBx3EgWCtd1xGGIZqmwY1ztC0m1c5tdPI8D4LVA4VORwoSbnGgKTJKEUURgiBAVVUyIee8t5gP3QM1TZOBQvszgx2fkJ0Z6muFsixR17UETFU5nCtAIhc32wvWmwTGjnUB42Axqh4BCSGzZzYMmoK9BMrzUAAqVE36EqhmfXezHwGXaFGFS/zXCmfa5tGHUw37qZ+AcRzjV/m+/wCKB23bNpIkkRYfxDe2LAumaeIOViQrm9BLrXQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"jenkins-is-ready\"\n        title=\"jenkins-is-ready\"\n        src=\"/static/6f752f66da458bdfe62dd9fd7e3af2a9/906b5/340-jenkins-is-ready.png\"\n        srcset=\"/static/6f752f66da458bdfe62dd9fd7e3af2a9/5ea4d/340-jenkins-is-ready.png 238w,\n/static/6f752f66da458bdfe62dd9fd7e3af2a9/466da/340-jenkins-is-ready.png 475w,\n/static/6f752f66da458bdfe62dd9fd7e3af2a9/906b5/340-jenkins-is-ready.png 950w,\n/static/6f752f66da458bdfe62dd9fd7e3af2a9/84f4d/340-jenkins-is-ready.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>3.5 메인화면 확인</h3>\n<p>내가 확인한 젠킨스 메인화면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d6d5c2b6bb85d7b53636520930cbb99e/84f4d/350-welcome-to-jenkins.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABqUlEQVQ4y5VT22rCQBTcLxEEfVao0FKoQouf2n6DL/rkTyjYvLRqUpPsJlGTbOKUWbvbKC2lB4YkZ/fMmXOJeBoOMR6PMXx4QLvdRqfTceh2u2i1WhiNRphMJpjNZphOp5jP53h+ecHj7R3uBwP0+n0Mbm7Q7/UgoiiEVApVVRlorR2s7xp1XX/frTSKskSelyhLDXHMIhRFgd/sdDq5BGVZGhyPRxPDM1qhT0gPGnUNCBl/E/ICQQW0/X6P5XIJ79XDZrOB53lYrVbGt1gsoJR0yYBzrIijCGmaXhDazFSTJAnSJDV30iwzvmZr+K115eJF9EV4zoILwjzP8f72hvV6jd1uhyDwsd1ukWWZqcL2uRkrQpkaFdZpD2j0SSnNOUkI9o+JLOy3I4xjCaWU6SMPD4eDKcMq9H3f9C8IAoRh+OM2XChMEoU4jg0ZiUjMAKsw8ANTLhMRppdfoGL77gip4ONj5+RzslYhiZmMYBUsnQmbsHGOkA42uDlh28PmDjLYJrre02a8aBJcD+Uv++meuFb2X1Cd/RX5FM0V+C/YBg6VQ1HyvC2fSjAgJT50I4oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"welcome-to-jenkins\"\n        title=\"welcome-to-jenkins\"\n        src=\"/static/d6d5c2b6bb85d7b53636520930cbb99e/906b5/350-welcome-to-jenkins.png\"\n        srcset=\"/static/d6d5c2b6bb85d7b53636520930cbb99e/5ea4d/350-welcome-to-jenkins.png 238w,\n/static/d6d5c2b6bb85d7b53636520930cbb99e/466da/350-welcome-to-jenkins.png 475w,\n/static/d6d5c2b6bb85d7b53636520930cbb99e/906b5/350-welcome-to-jenkins.png 950w,\n/static/d6d5c2b6bb85d7b53636520930cbb99e/84f4d/350-welcome-to-jenkins.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>4. github 와 jenkins 연동하기</h2>\n<p>github 저장소가 업데이트 되면 jenkins 로 알리고 빌드하도록 연동한다.</p>\n<h3>4.1 jenkins ssh key 설정</h3>\n<p>젠킨스와 깃허브는 ssh key 를 통해 연결된다.</p>\n<h4>4.1.1 키 조합 생성</h4>\n<p>아래의 명령어로 젠킨스 컨테이너의 쉘에 접속한다. 컨테이너 이름인 <code class=\"language-text\">jenkins_cicd</code> 가 아니라 컨테이너 id 로도 접속 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> -it jenkins_cicd /bin/bash</code></pre></div>\n<p>이제 깃허브와 연결할 ssh 키를 생성한다</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># mkdir /var/jenkins_home/.ssh\r\n\r\n# ssh-keygen -t rsa -f /var/jenkins_home/.ssh/jenkins_ci</code></pre></div>\n<h4>4.1.2 jenkins 에 개인 키 등록</h4>\n<p><code class=\"language-text\">/var/jenkins_home/.ssh/jenkins_ci</code> 파일(개인 키)의 내용을 젠킨스에 등록해야 한다.</p>\n<blockquote>\n<p>[젠킨스 서버 IP]:8080/credentials/store/system/domain/_/newCredentials</p>\n</blockquote>\n<p>위의 경로로 들어가서 다음 사진과 같이 선택하고 개인 키를 붙여넣는다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3a2778565e353fb18d2f61127bc6932a/84f4d/412-new-credentials.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.89075630252101%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABuklEQVQ4y32USW4bMRBFdTfvvDAMGD6LL5UjOMg2qyyzsuVFDAiSwqGb81D8QTW7ESWtVgEPJEjUR03kTmoBqSSUUhM+BHjnMB6PGIWAERJGCMRxRHEOxdoVeT6PxmD367fE+XyEEBLee8QYkVNCOJ0QlUKUEmUYAOfRrAWZ/zEga9HGEe50wo6oobW/UGtAa/CHA8bDAUkqJCknstZd4JKxr01rWBbEhbHgYhx+0BrJGiTT4dRajCsoRiAEOK2xu4xugS2lhJILiAhU60RlSllRSgFVgnVuHeEi6LyHGgZkFmkNlWbaFaiB2OeaINePJUuMKD6ghE69Ad9z2pa7vIpw3nOBeWyQM1pKk8MWlWvpPZwQ1yLs+2wMvJRTY+IwoDqH6vwm5FxvylYNQ4wYuMvzXIJozTIV88pzvCk42oDzMKKiB01b8BQQTZp+symtTaOQPz9R9nvkjw/k/R7p/b3D+7c3JKVgvYfWGsYYGGNvCVaUlxf4uzuEhwfkx0fQ01Pn+Rl0fw96fZ0yoHkW+S/YTLnkDM8N4TrOH8M/LyQEtFqncix+OedtwS9fv+Pbj5/9HDfswodf0h/epIsVw5CoAQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"new-credentials\"\n        title=\"new-credentials\"\n        src=\"/static/3a2778565e353fb18d2f61127bc6932a/906b5/412-new-credentials.png\"\n        srcset=\"/static/3a2778565e353fb18d2f61127bc6932a/5ea4d/412-new-credentials.png 238w,\n/static/3a2778565e353fb18d2f61127bc6932a/466da/412-new-credentials.png 475w,\n/static/3a2778565e353fb18d2f61127bc6932a/906b5/412-new-credentials.png 950w,\n/static/3a2778565e353fb18d2f61127bc6932a/84f4d/412-new-credentials.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>4.1.3 github 에 공개 키 등록</h4>\n<p>이번엔 <code class=\"language-text\">/var/jenkins_home/.ssh/jenkins_ci.pub</code> 파일(공개 키)의 내용을 깃허브에 등록해야 한다.</p>\n<blockquote>\n<p><a href=\"https://github.com/%5Busername%5D/%5Breponame%5D/settings/keys/new\">https://github.com/[username]/[reponame]/settings/keys/new</a></p>\n</blockquote>\n<p>위의 경로로 들어가서 다음 사진과 같이 공개 키를 붙여넣는다</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9dd797929232ca097daadfbe85b2bad3/9239a/413-add-new-deploy-key.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.80672268907564%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACFElEQVQ4y4WTy3LTMBSG1ZJLE8e27rIlxbLjtElLuO6YYXhJHoYtA3SGF2FaljzBz0hxbguGxTc6sqxfR+c/Iv32NXx3D+N7yLoDVR7SrhDWOyxXW4T+AWH9EjbcQVQNtOugbAftVkdsc4uw2WGzew9SCAvhtxB+A9nsoMIryLCDrAOotChFfYQqB9feoekfkoisApRtUfkeqm4RVhuQgldgyh3h2oMpD24CRBUgqwbCLId1D2U8rA3ImcGC6kSM54XEsr0FiVnETVmp0mJWSlAdIJYP4PUadtlD1wGLUiGPmyOlQsHMBReCvt3AuC6dlFOTrsfrgIxXGGUMk5xjkguMFxzTQmLOK8yjyED87ygYrxzrEIlxzJJLi4oq8IxCZGyADjCIxSVswS8zrJt1yqqgGiNm8CHn+H11jWdC8DTwfMZh/osQ/CEEX65fYHYQjMV24e4oOOUV3uYcX8cTPE5u8GNyg8dpHKcpPsy/Tab4fjPDz9EYn69HJ8Hoaujvk5PRmFjHWaFAco0rVoEUckCcIUFyDlIqkIyBzIrLK6s67PtMWmSFAvce24/v4JoeUnkI5dIolUsxZQYl1XuYATs3RdQt+vs36VUY34FLD9Z6uE8b5MpgUerBfX0iztnZ99Q2Ci70sYY+mRIdjgsx07zUmM/laTM1g8i/ieXSttmbEvtQ2/ai83Nujq/hf2IHQeMC/gLaPlMp16GD2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"add-new-deploy-key\"\n        title=\"add-new-deploy-key\"\n        src=\"/static/9dd797929232ca097daadfbe85b2bad3/906b5/413-add-new-deploy-key.png\"\n        srcset=\"/static/9dd797929232ca097daadfbe85b2bad3/5ea4d/413-add-new-deploy-key.png 238w,\n/static/9dd797929232ca097daadfbe85b2bad3/466da/413-add-new-deploy-key.png 475w,\n/static/9dd797929232ca097daadfbe85b2bad3/906b5/413-add-new-deploy-key.png 950w,\n/static/9dd797929232ca097daadfbe85b2bad3/9239a/413-add-new-deploy-key.png 1246w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>4.2 github webhook 설정<a id='4.2-github-webhook-설정'></a></h3>\n<p>이제 깃허브에서 이벤트 발생 시 젠킨스에게 알리도록 할것이다.<br>\n젠킨스에는 깃허브 플러그인이 설치되어 있어서 깃허브에서만 설정해주면 바로 사용 가능하고 한다.</p>\n<blockquote>\n<p><a href=\"https://github.com/%5Busername%5D/%5Breponame%5D/settings/hooks/new\">https://github.com/[username]/[reponame]/settings/hooks/new</a></p>\n</blockquote>\n<p>위의 경로로 들어가서 다음 사진과 같이 Payload URL 에 <code class=\"language-text\">[젠킨스 서버 IP]:8080/github-webhook/</code> 을 입력후 추가한다.<br>\n기본 옵션이 push 이벤트만 알리도록 하는것인데 지금 당장은 다른 이벤트 알림은 필요 없기 때문에 따로 설정할건 없다.\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/356e1e4d811bdab3fe2d23e48c51dad3/9239a/421-add-webhook.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74.36974789915966%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACF0lEQVQ4y31Ty47bMAzMqdg8/JZky9bDsp3YibspChTbaz+gx/7/r0xBul4k2XQPBAWJGs5Qo83l2xtqN0DbDkVpkAqNyvToxitsd0Z3uiKMr2jaE4RuIesAWa95CW0HmONXzN/fsMnKFoU5ozATCntBbi+cpW6RihqpaDjHecVr7Y4w7YjaH6HqgLLp0PgT52GcsaHivPQoKs8MRB2WdWVRlBa5MsjLZV1UDrUJcH7gBmskhcY2FgjDhE0mGy4+pApRpnBIJbLSQfkZrr+wnEwRoENeOs7L2t412kbFAkgMpPbcKcpKBswrBztcGdCGCSaMLIuk2m7ibNoTmjCh8hOI1MstoOvOqGzPgFGqmJEOM/LKc/Eqm/NNpMoilpbJvAMSZW173mTZicReNvipHX7vE+Sy5kfZRQW+bBO87DPsqSaRrIaC7r5LVqZnGTTYRGjOxMr3Z1RNgCKL/BvJOpbbOGTlPaB2J/TjK18iIIpULlbZJYIZ7GPBzLaHHLtY3AOm6h5wncfyykvBypJA1xmS6ckFj4DRI0OhPVw3sTFp8DQb8iH9lI6Y1y1bQ1SOG90yW+OBoeU5rYdUTMxk1aKsAwPRPjFbzz9lSCbVbkBS1EvnRCLXHn6aIRrH7DJlWPozsA+AVEy/gR7lQD8lVkhdg/HPD7hfM18gqfGN3KePEgu49ogNbSyeUh8K/yfxGUMaiW0H/AXW3nzcRhEeTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"add-webhook\"\n        title=\"add-webhook\"\n        src=\"/static/356e1e4d811bdab3fe2d23e48c51dad3/906b5/421-add-webhook.png\"\n        srcset=\"/static/356e1e4d811bdab3fe2d23e48c51dad3/5ea4d/421-add-webhook.png 238w,\n/static/356e1e4d811bdab3fe2d23e48c51dad3/466da/421-add-webhook.png 475w,\n/static/356e1e4d811bdab3fe2d23e48c51dad3/906b5/421-add-webhook.png 950w,\n/static/356e1e4d811bdab3fe2d23e48c51dad3/9239a/421-add-webhook.png 1246w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>그 다음엔 정상적으로 연결되었는지 확인한다. 만약 초록섹 체크 표시가 아니라면 젠킨스 서버 EC2 인스턴스의 SG를 확인해봐야 한다.<br>\n만약 SG 인바운드 규칙을 수정했는데도 커넥션이 정상적이지 않다면 새로고침만 계속 누르지 말고 삭제 후 다시 등록하자.<br>\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 320px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bf5d254e6ec726496239dc21195e3c26/72799/422-connection-check.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.40336134453782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACEUlEQVQoz42TTXLaQBCFVUnKsUFI6F9IAhkQ6A8JIYFi/JfgpGIvnE02uVGukcPkAlnkPl9KMhCnKgsvXnXPzKueed1vhNOuwtsGYhNVTsU9ugpd2aCnWIh9s40vgZBV12RFTZrXpMs1/jRmGi8JszWq4dKVX16sLbi5uuP+8SsfPj5yeXvH9vYTV7sH3n/+wvB8xllPO77yJRAauSedJ8lHuXs0BEm1/4ve87x53T4XVNOjrztI6qCFrA3adUM6khX7KOnQz79nVsuXNRuxkZxXW+rLO4pqS1ZtCeOCor4lTArS4oK8vGBRXJAsK5Km18WGeboizmpmUU6U15TlJcXmijhdIfhByrLakmQbpmFGtqqJFyVRUhKEeTuwaZSTLDcEUUG2ai55hx8kzNOSWZQRLtYsioqovEGwvAm2N8Z0xjijGX6cY44jtNEM/XyOM4kZDKc4owDHn+/jjOE4YjSJGU3mDCdNHmL7IcLzCXYkjaGoMuupBJLGvKfhSBpdddCed5tc1p+ipNPZo/FrRzYQZQNBGbjI7gBjeo2ePfDjTObXq9f8fHPCb0Hgu+ohrb/hLu6xsx1mssMMb1C8GNcP2nbotn/8BMLThG1kzUU2fWzVxlUsHMXCUyzMxg6ag2yM6JsjZN1F1r12TzEc+obbOuNgIeFgAam1gElXtY/oqDZiSzz8BHPPs57tWf948g/vQT30Kg6DfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connection-check\"\n        title=\"connection-check\"\n        src=\"/static/bf5d254e6ec726496239dc21195e3c26/72799/422-connection-check.png\"\n        srcset=\"/static/bf5d254e6ec726496239dc21195e3c26/5ea4d/422-connection-check.png 238w,\n/static/bf5d254e6ec726496239dc21195e3c26/72799/422-connection-check.png 320w\"\n        sizes=\"(max-width: 320px) 100vw, 320px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p><code class=\"language-text\">Let me select individual events.</code> 를 선택하면 거의 모든 이벤트(포크, Key 추가 등)에서 웹훅 트리거를 작동 시킬 수 있는것같다.</p>\n</blockquote>\n<h2>5. jenkins job 설정</h2>\n<p>job 이란 젠킨스에서 실행되는 작업의 단위라고 한다. 이 job 을 생성하고 어떤 작업이 수행될지 정의한다.</p>\n<h3>5.1 job 생성하기</h3>\n<blockquote>\n<p>[젠킨스 서버 IP]:8080/view/all/newJob</p>\n</blockquote>\n<p>위의 경로에서 이름을 정하고 Freestyle project 를 선택한 뒤 다음으로 넘어간다.\r\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8065485c04845e3f229876f4caa19d94/84f4d/510-new-item.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACRklEQVQ4y22Tu24TQRSG/RopI1tpUplLEwQFhEcIb5AnIR0SL0FDRUNDEZdGQog2SJDYeO3dnd2Zvcxlb7HXPzpnHccmjPTpP17P/nvmnDm9ly+e4/T0NZ6dnODw8BCDwQD9fh+Dfh9HR0c4ODjA+fk5xuMxLkcjjEYjjt9eXODVk6d4PHyE4XCI4+NjvDk7Qy/XBs4VqOoaq7bdslytcLtc3nN7+1+Wm//atoW1Fj1sVhYECCcTBJMJqxYCRZKgUAqFlHBpCuscnLWw1sG5fWhVVYVeu17zDzKZTqfwgwC+7yOOJZI07YhjZGEIbS1yraG1Zt2FfMqyRG+9Mcz9AOL3NbLZDGaxgAsCWN+H9QOY+QI2iuDynDN1WbaHTVOs2xYlZbg1nP2CmF4hnC8QkxFv7DaXWqOyFoXWzF1MH6icQ5PnQNOgrOt7Qx1LCM/joxVULylhlWItswyNNqjzHLXWTHOnpnuO1Wo/Q+NKLIIQ/mIBqRRkHENKCbWJoyhCopKufnnOaiimk9iuKXs1JHcy8jwPc89jpRfpKhhjYI3tTIxhtDHc3aZpuLsPDD2R4ufNHGmi+MUsyxgy3dVdaF9RFMwDQ5kZTLwQQgg+ZpIkzF2sEnUfK4qTLnutWbf3kAzJktKvbI5UxpjNZpwRPbN8kS3HxnRa1/UeZESTQlOznZQ/IsD7j59x+f0HlIyQJCmb7kKTUlU11+1faJFpj+vgLK5urvHuwyd8+foNaaoQhoKPL6KoUyF4eqRU3P1dYin5g9Ssv0dPCCnJkWypAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"connection-check\"\n        title=\"connection-check\"\n        src=\"/static/8065485c04845e3f229876f4caa19d94/906b5/510-new-item.png\"\n        srcset=\"/static/8065485c04845e3f229876f4caa19d94/5ea4d/510-new-item.png 238w,\n/static/8065485c04845e3f229876f4caa19d94/466da/510-new-item.png 475w,\n/static/8065485c04845e3f229876f4caa19d94/906b5/510-new-item.png 950w,\n/static/8065485c04845e3f229876f4caa19d94/84f4d/510-new-item.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h3>5.2 소스코드 관리 탭 설정하기<a id='5.2-소스코드-관리-탭-설정하기'></a></h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1ee1e709abc4d784f40de5a75a3efcd7/84f4d/520-source-code-manage.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABsUlEQVQ4y4WTW5LTQAxFs05WwxrYCWvghx8WECoMTDJjEsdxd0vqZ2JfSj1OcEh5cNUttVXWab28MtaCReB9gIiAiEDEcESwzsE5B2td9avVd/2OWcX1XErB+XxGSgkrzB5ij95YxBQh3oM0SC9hfrMKEo8QY5WPETFGjONY4xW60perg8Tj+ccTzPGI4j3OIaCEMFlffXkuEeQQbvGXy+UemJnR7XY4Nr9BpxPEGEhvwH2P4BwSMRLRZCd1JwzDUONryXNgYob99Qy328E3DWS/h/Q9uOsQrUUhRia6U3LuBgwhPAJPLy/oDy3soUXqTW14yRk5pZrBXOrLOWMYxgVgjLVPqlpiCEg5vwEUquerTbkOS7fjGv8ITAmOpSqV8he2oDjZxZJ1FdpDi7Zt4b2vGVctQXXKCrwONed7YCRCs9mgefqJdruF2e8RjKmNv5O1dSN4vUZ4fcU47fHj2ohAuq4Op+jtzO9LPJIxt5IfFlsbbfsepFlpyf/TVPLin+KYsNlu0bQHsGfEnJBLeVeaxPAv8DKl/G39HR8+fsLnL18RAoGEkHOpzV6SbsIc+AdRHz4U39dkTgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"source-code-manage\"\n        title=\"source-code-manage\"\n        src=\"/static/1ee1e709abc4d784f40de5a75a3efcd7/906b5/520-source-code-manage.png\"\n        srcset=\"/static/1ee1e709abc4d784f40de5a75a3efcd7/5ea4d/520-source-code-manage.png 238w,\n/static/1ee1e709abc4d784f40de5a75a3efcd7/466da/520-source-code-manage.png 475w,\n/static/1ee1e709abc4d784f40de5a75a3efcd7/906b5/520-source-code-manage.png 950w,\n/static/1ee1e709abc4d784f40de5a75a3efcd7/84f4d/520-source-code-manage.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span>\r\n깃허브를 통해 소스코드를 관리할것이기 때문에 당연히 Git 을 선택한다.<br>\nRepository URL 에는 본인의 깃허브 저장소 주소를 적어주고, Credentials 에는 아까 추가한 키를 선택한다.</p>\n<p>그리고 빌드할 브랜치를 설정하는데, ? 를 눌러 설명을 보면 알겠지만 하나의 job 에서는 하나의 브랜치만 빌드 할 때 효과적이라고 한다.<br>\n게다가 나는 기능 개발시 새로운 브랜치를 생성하고 완료되면 master 브랜치에 반영하고 있기 때문에 master 브랜치만 빌드하도록 설정하는것이 개발 완료된 기능만을 빌드하는것이라고 볼 수 있다.</p>\n<h3>5.3 빌드 설정</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/48438c67be2cc6959ad4847dcb822f08/84f4d/530-build-configuration.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68.90756302521008%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB40lEQVQ4y42T246bMBRF88/9kf5Bf6DPfa7Ul5H6WrVR04iEJGAPBt8AXwDv6jiXaarMaJCWjC3tzTn7mJVUCrbvMYwjemvRaw0jJXTXwUoFoxQUnRmTV60N+r7PkK4fBsQYMU0TvPdY4Z+nOx1RrNeQnEM3DYwQMHWdTUlMprSO45gZhgHOOaSUsn6eZ6xocz1QvMGfYod9WeJUVaifG1jRIjqHECNiCAgPuOqpyntD1qBY/wbb7aA5h2kaDJwjjA4+hNzS/7xpqKXEsSwxUlsXgnMPjd5laK3FdrvFZrNBURRohMgZhUfVXc7eNKSJ7Xc7HI9HsJqBMYa2bfMAcl4Xg9t7jJlXh6LrGrKqELVGuOCVgpfyvF6hvdYYqwr++fmmpw/dGbquQ1mW0Frnu3Vu6Yz3L21TDD5G2MMBjrGbnjo5G9IupVwR5Ub3jUyt7eFchHMe7tIu5XQjJURjsMzzY0NqpapqlOUBdc1QnQyqSoEzjq5tc9VpWV5ICZPWDwxTwkJYQ5NB32p0rM1ILnJuOVOl77IcaGBCYFmWc2TO3f96JyHw+esTfu1LxMnDBYdpnhGn6SGDc3A+3PRkvKK8pJRw44DvP37iw8dP+PLtCZzXqHkNIcSr0JUilFI5c/L6CyuzOHdcB76dAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"source-code-manage\"\n        title=\"source-code-manage\"\n        src=\"/static/48438c67be2cc6959ad4847dcb822f08/906b5/530-build-configuration.png\"\n        srcset=\"/static/48438c67be2cc6959ad4847dcb822f08/5ea4d/530-build-configuration.png 238w,\n/static/48438c67be2cc6959ad4847dcb822f08/466da/530-build-configuration.png 475w,\n/static/48438c67be2cc6959ad4847dcb822f08/906b5/530-build-configuration.png 950w,\n/static/48438c67be2cc6959ad4847dcb822f08/84f4d/530-build-configuration.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h4>5.3.1 빌드 유발</h4>\n<p>빌드 유발 옵션에서 <code class=\"language-text\">GitHub hook trigger for GITScm polling</code> 를 선택했다.<br>\n이 옵션이 선택되어 있다면 깃허브에서 훅을 수신 했을 때, 이 훅의 저장소가 <a href=\"#5.2-%EC%86%8C%EC%8A%A4%EC%BD%94%EB%93%9C-%EA%B4%80%EB%A6%AC-%ED%83%AD-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">4.3.2</a> 에서 설정한 저장소와 일치하는지 확인한다.</p>\n<blockquote>\n<p><a href=\"#4.2-github-webhook-%EC%84%A4%EC%A0%95\">4.2</a> 에서 push 이벤트만이 웹훅 트리거를 작동시키도록 설정했기 때문에 해당 저장소에 push 할 경우에만 훅을 수신한다.</p>\n</blockquote>\n<p>일치한다면 저장소에 대해서 폴링(소스코드를 가져오는것)한다. 폴링할 때 변경사항이 있다면 빌드를 시작한다.</p>\n<blockquote>\n<p><a href=\"#5.2-%EC%86%8C%EC%8A%A4%EC%BD%94%EB%93%9C-%EA%B4%80%EB%A6%AC-%ED%83%AD-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">5.2</a> 에서 master 브랜치만 빌드하도록 설정했기 때문에 해당 브랜치만 폴링하고 빌드한다.(라고 이해했음)</p>\n</blockquote>\n<h4>5.3.2 build</h4>\n<p>마지막으로 빌드할때 실행될 코드를 작성한다.<br>\n나는 django 를 사용하기 때문에 django 를 테스트 하기 위한 코드를 추가했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 의존성 패키지를 설치하고 마이그레이션 후 테스트하는 코드</span>\r\n\r\npip <span class=\"token function\">install</span> -r requirements.txt\r\n\r\npython3 manage.py makemigrations --settings<span class=\"token operator\">=</span>config.settings.prod\r\npython3 manage.py migrate --settings<span class=\"token operator\">=</span>config.settings.prod\r\npython3 manage.py <span class=\"token builtin class-name\">test</span> --settings<span class=\"token operator\">=</span>config.settings.prod</code></pre></div>\n<h3>5.4 테스트를 위한 도구 설치</h3>\n<p>실제로 job 이 실행되는지 보기 전에, 빌드할때 테스트가 잘 실행되도록 테스트에 사용할 도구를 먼저 설치해야 한다.</p>\n<blockquote>\n<p>물론 깃허브에 push 할 때 테스트 완료된 코드를 올리겠지만 실제 운영환경에서 테스트 해보는것이다.(라고 이해했음)</p>\n</blockquote>\n<p>테스트코드 실행을 위한 도구를 설치하기 위해 컨테이너의 쉘에 다시 한번 접속한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> -it jenkins_cicd /bin/bash</code></pre></div>\n<p>django 를 테스트 하기 위한 도구를 설치했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">apt-get</span> update -y\r\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y\r\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> docker.io -y\r\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> python3 pip -y\r\npip <span class=\"token function\">install</span> <span class=\"token assign-left variable\">django</span><span class=\"token operator\">==</span><span class=\"token number\">3.2</span>.6</code></pre></div>\n<p>그리고 mysqlclient 의 원활한 설치를 위해 관련된 패키지도 설치했다. <a href=\"https://pypi.org/project/mysqlclient/\">출처</a></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> python3-dev default-libmysqlclient-dev build-essential -y</code></pre></div>\n<h2>6. 연결 테스트 하기</h2>\n<p>젠킨스와 깃허브 연동도 했고 깃허브 저장소에 push 했을 때 실행 될 job 도 만들어줬다.<br>\n이제 master 브랜치에 push 했을 때 젠킨스로 전달되어 빌드되는지 확인해볼 시간이다.</p>\n<p>우선 개발 PC 에서 master 브랜치로 push 한다.<br>\n그러면 다음 사진과 같이 해당 젠킨스 Job 의 build history 에 빌드가 하나 추가 된 것을 볼 수 있다.<br>\n지금까지 한 작업이 모두 정상적이였다는것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d41ef3ef9ae19cab86dafb648473fb57/84f4d/600-0-build-history.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.18487394957983%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABdUlEQVQoz5WSzW6bQBSFeTLvLO+CIjddNIta6davk26SV2geITt71bxBrdrFxgZCmMGeAQzDFzESkiFJ5VzpaKS5R9898+N8HY+ZTCZcX39jOBx2NBqNGAwGTKdT5vO51Ww24+n3E3f393z/csX48pIL18V1XX7c3OBUdUlxPGJMzblV1+97q6rC8eMYkbyQpilaaZRS5HnOer3mz2KBv/VtrwWdyhhjVRto8mitcOIXQSqlbTQTWp2m+UhNqSzn58Mjt78eWXg+TiKlTdAa2nW1jfgXCCpjdzv9U2BVGVa7CC+ISYTEEVKite6Ym9rufFbehkNm3gz76C6zLMPJkgSZJBRF0TFFYcjy7xLTS9aHtXfZVBPMUXuBOhwoy/LTr9rvW6BMJXEco7OMY3lEaW2/UT/V/6AdoHiOed4F7IUgV4p9ktj1vWOeBYwWS9JgxyEI2QcBKgwpoqhxUZ9x3DdAJQSh77P1PKtgs0H1PvK5wOYdXgGMhYsT93ysfgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-history\"\n        title=\"build-history\"\n        src=\"/static/d41ef3ef9ae19cab86dafb648473fb57/906b5/600-0-build-history.png\"\n        srcset=\"/static/d41ef3ef9ae19cab86dafb648473fb57/5ea4d/600-0-build-history.png 238w,\n/static/d41ef3ef9ae19cab86dafb648473fb57/466da/600-0-build-history.png 475w,\n/static/d41ef3ef9ae19cab86dafb648473fb57/906b5/600-0-build-history.png 950w,\n/static/d41ef3ef9ae19cab86dafb648473fb57/84f4d/600-0-build-history.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>시간이 지나면 이렇게 빌드가 완료된다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 343px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/038b9f02f4063a1f4b65da193bddaf3a/41431/600-1-build-complete.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.033613445378144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQoz42Qy27CMBBF/f/fxIYNUVkGO0RigWgeEGJKsPOwHVu3GpMiIbVSF0czGs/cuWOmdI9hHKG0Rj+MMdf9AOfmf2EpzjOMtbDOgbWtxL2743K54Hb7Qitb1OdzbPAhwHsP78OT8As+IIQQxWiG6Wlxs2wx1i35s8Fa92IyFpMxf0JzbPspwAWHbCXmeYZSCsfjMTpumgZlWeJ0OsX4eDxgrcU0TRFDGPMG67SClDI2j+MYi5T3fY9hGOLf0hKqkYhz7g0br7Cxl+aZXgYokqPVaoV8v4cQHFwI7LMMyWaDlAus12ukaQrOOXa7HUSWYbv9QJIkuHdd1GCk+nKjFPI8R13XKIoCRVmiripUVYXmesXhcIin/1AtbwRpkMNvaMoUUOZt7EAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"build-complete\"\n        title=\"build-complete\"\n        src=\"/static/038b9f02f4063a1f4b65da193bddaf3a/41431/600-1-build-complete.png\"\n        srcset=\"/static/038b9f02f4063a1f4b65da193bddaf3a/5ea4d/600-1-build-complete.png 238w,\n/static/038b9f02f4063a1f4b65da193bddaf3a/41431/600-1-build-complete.png 343w\"\n        sizes=\"(max-width: 343px) 100vw, 343px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>만약 빌드가 실패했다면 Console Output 탭에서 로그를 확인할 수 있다.</p>\n<h2>7. docker image 배포하기</h2>\n<h3>7.1 docker image 설정</h3>\n<p>일단 장고 프로젝트에 빌드를 위한 Dockerfile 이 있어야 한다고 한다. 이 도커파일을 기준으로 도커 허브에 업로드 될 이미지가 생성된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token instruction\"><span class=\"token keyword\">FROM</span> python:3.8</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">WORKDIR</span> /usr/src/app</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> requirements.txt ./</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> pip install --upgrade pip</span>\r\n<span class=\"token instruction\"><span class=\"token keyword\">RUN</span> pip install -r requirements.txt</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">COPY</span> . .</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">EXPOSE</span> 8000</span>\r\n\r\n<span class=\"token instruction\"><span class=\"token keyword\">CMD</span> [<span class=\"token string\">\"./manage.py\"</span>,<span class=\"token string\">\"runserver\"</span>,<span class=\"token string\">\"8000\"</span>]</span></code></pre></div>\n<h3>7.2 docker hub repository 생성<a id='7.2-docker-hub-repository-생성'></a></h3>\n<p><a href=\"https://hub.docker.com\">https://hub.docker.com</a></p>\n<p>위의 링크로 들어가 회원가입 후 저장소를 생성한다. 차후 운영서버에서 이 저장소의 최신 이미지를 사용하여 컨테이너를 만들게 된다.<br>\n나는 private 저장소를 생성했다.</p>\n<h3>7.3 빌드 및 업로드 자동화 쉘 스크립트 작성</h3>\n<p>dockerhub 에 자동으로 버전을 관리하며 업로드 하는 스크립트이다. 이 스크립트를 젠킨스 디렉토리에 생성해준다.<br>\n이후 ID, PW 를 도커 허브의 계정으로 변경한다. 만약 계정 비밀번호에 특수문자가 들어있다면 작은따옴표로 감싸준다.</p>\n<blockquote>\n<p>지금은 다른 사람이 만든 스크립트를 그대로 사용했지만 도커에 대한 이해도가 높아진다면 원하는대로 커스텀 할 수 있을것이다</p>\n</blockquote>\n<p><a href=\"https://coding-chobo.tistory.com/54\">쉘 스크립트 특수문자</a></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># 경로 : /var/jenkins_home/CICD/Docker_CD.sh</span>\r\n\r\n<span class=\"token comment\">#!/bin/bash</span>\r\n\r\n<span class=\"token assign-left variable\">DOCKER_REPOSITORY_NAME</span><span class=\"token operator\">=</span><span class=\"token variable\">$1</span>\r\n<span class=\"token assign-left variable\">ID</span><span class=\"token operator\">=</span>ohyunkyo\r\n<span class=\"token assign-left variable\">PW</span><span class=\"token operator\">=</span><span class=\"token string\">'test!@#$'</span>\r\n\r\n<span class=\"token comment\">#docker image의 첫 tag를 확인 후, 다음 버전의 image를 생성</span>\r\n<span class=\"token comment\">#만약 처음 생성되는 이름이라면 0.01 이름으로 생성해준다.</span>\r\n\r\n<span class=\"token assign-left variable\">TAG</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">docker</span> images <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> -v <span class=\"token assign-left variable\">DOCKER_REPOSITORY_NAME</span><span class=\"token operator\">=</span>$DOCKER_REPOSITORY_NAME <span class=\"token string\">'{if ($1 == DOCKER_REPOSITORY_NAME) print $2;}'</span><span class=\"token variable\">)</span></span>\r\n\r\n<span class=\"token comment\"># 만약 [0-9]\\.[0-9]{1,2} 으로 버전이 관리된 기존의 이미지 일 경우</span>\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span> <span class=\"token variable\">$TAG</span> <span class=\"token operator\">=~</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token punctuation\">]</span><span class=\"token punctuation\">\\</span>.<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-9<span class=\"token punctuation\">]</span><span class=\"token punctuation\">{</span><span class=\"token number\">1,2</span><span class=\"token punctuation\">}</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n    <span class=\"token assign-left variable\">NEW_TAG_VER</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token builtin class-name\">echo</span> $TAG <span class=\"token number\">0.01</span> <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'{print $1+$2}'</span><span class=\"token variable\">)</span></span>\r\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"현재 버전은 <span class=\"token variable\">$TAG</span> 입니다.\"</span>\r\n    <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"새로운 버전은 <span class=\"token variable\">$NEW_TAG_VER</span> 입니다\"</span>\r\n\r\n<span class=\"token comment\"># 그 외 새롭게 만들거나, lastest or lts 등 tag 일 때</span>\r\n<span class=\"token keyword\">else</span>\r\n    <span class=\"token comment\"># echo \"새롭게 만들어진 이미지 입니다.\"</span>\r\n    <span class=\"token assign-left variable\">NEW_TAG_VER</span><span class=\"token operator\">=</span><span class=\"token number\">0.01</span>\r\n<span class=\"token keyword\">fi</span>\r\n\r\n<span class=\"token comment\"># 현재 위치에 존재하는 DOCKER FILE을 사용하여 빌드</span>\r\n<span class=\"token function\">docker</span> build -t <span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$NEW_TAG_VER</span> <span class=\"token builtin class-name\">.</span>\r\n\r\n<span class=\"token comment\"># docker hub에 push 하기위해 login</span>\r\n<span class=\"token function\">docker</span> login -u <span class=\"token variable\">$ID</span> -p <span class=\"token variable\">$PW</span>\r\n\r\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$NEW_TAG_VER</span> <span class=\"token operator\">!=</span> <span class=\"token string\">\"0.01\"</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">then</span>\r\n    <span class=\"token function\">docker</span> rmi <span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$TAG</span>\r\n<span class=\"token keyword\">fi</span>\r\n<span class=\"token comment\"># 새로운 태그를 설정한 image를 생성</span>\r\n<span class=\"token function\">docker</span> tag <span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$NEW_TAG_VER</span> <span class=\"token variable\">$ID</span>/<span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$NEW_TAG_VER</span>\r\n\r\n<span class=\"token comment\"># docker hub에 push</span>\r\n<span class=\"token function\">docker</span> push <span class=\"token variable\">$ID</span>/<span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$NEW_TAG_VER</span>\r\n\r\n<span class=\"token comment\"># tag가 \"latest\"인 image를 최신 버전을 통해 생성</span>\r\n<span class=\"token function\">docker</span> tag <span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$NEW_TAG_VER</span> <span class=\"token variable\">$ID</span>/<span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span>:latest\r\n\r\n<span class=\"token comment\"># latest를 docker hub에 push</span>\r\n<span class=\"token function\">docker</span> push <span class=\"token variable\">$ID</span>/<span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span>:latest\r\n\r\n<span class=\"token comment\"># 버전 관리에 문제가 있어 latest를 삭제</span>\r\n<span class=\"token function\">docker</span> rmi <span class=\"token variable\">$ID</span>/<span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span>:latest\r\n<span class=\"token function\">docker</span> rmi <span class=\"token variable\">$ID</span>/<span class=\"token variable\">$DOCKER_REPOSITORY_NAME</span><span class=\"token builtin class-name\">:</span><span class=\"token variable\">$NEW_TAG_VER</span></code></pre></div>\n<h3>7.4 젠킨스 빌드할 때 쉘 스크립트가 실행되도록 설정</h3>\n<p>다시 Job 설정으로 돌아가서 방금 전에 생성한 스크립트가 젠킨스 빌드시에 실행되도록 설정해준다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5df995eca7f5ad84f98f0807bfe833be/84f4d/740-exec-shell.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABbUlEQVQoz3WSu24cMQxF97v9ISlT+QvSpEidIq6D1C5ia0cT6zF6c6S5AWnPwN71CjiQKOheUpROKWfknNFaQ4gRz0ph0hrTpPH36Qnn84QXY+C8h3UO1jqEEBFCQFiCrNd1Re9dPE54N4gISp0xzzOstYIxBt4vkjSlJJRShEqE0hq2bRM9m5442Df4sNb6qPgWtVY0IqRpQlkWbG8FXRly6UopGGNFtFfyGVxdVArZuY+GvHhvuPiIFBPK2xVZTCmhE2FsG8YYr/QhRrR2iXf9lWEuFbmuSJmQCyEVwtq7ZL9k9C59H+NVz626MowxYQkZPuRjLqVKCy7hX8Hndz3f5oMhrSus91hCQGsV1JrwmRmTcxFuvrJkdRYpBNR62+iS3eN4lH2EFPH95y88/P6DmBbEHKVHl/DXoTEQHx9RjDn0bHriRsYYUUvBs55w9+UeX7/9wDxP0P80nHfwzsM5B+/9wR7zzPr90/8H181WUdYumgAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"exec-shell\"\n        title=\"exec-shell\"\n        src=\"/static/5df995eca7f5ad84f98f0807bfe833be/906b5/740-exec-shell.png\"\n        srcset=\"/static/5df995eca7f5ad84f98f0807bfe833be/5ea4d/740-exec-shell.png 238w,\n/static/5df995eca7f5ad84f98f0807bfe833be/466da/740-exec-shell.png 475w,\n/static/5df995eca7f5ad84f98f0807bfe833be/906b5/740-exec-shell.png 950w,\n/static/5df995eca7f5ad84f98f0807bfe833be/84f4d/740-exec-shell.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><code class=\"language-text\">bash /var/jenkins_home/CICD/Docker_CD.sh \"docker_repository_name\"</code><br>\n이 쉘 스크립트는 첫번째 인자로 도커 레포지토리의 이름을 입력받는다.<br>\n<a href=\"#7.2-docker-hub-repository-%EC%83%9D%EC%84%B1\">7.2</a> 에서 생성한 이름을 사용하면 된다.</p>\n<h3>7.5 업로드 된 도커 이미지 확인</h3>\n<p>젠킨스 빌드가 성공했다면 다음과 같이 도커 저장소에 이미지가 업로드 되었을것이다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/280337045f286628fabbd9ea92b3b958/9cea8/750-docker-images.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.94117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABc0lEQVQoz4WSS0vDQBSF8/8XLlwILhQXgqAoguLKjUp9FItYRF25UKIimknTTOZ558gdM6m1LV44kJkM37mvrFEKtZQY1zXK0QjWWoQQQEQz8t7BOwcij3lhnUM2qipI2UApjaZR8EQzD9mA4+k5x3Gvj5PLAU6vbnBxcxfVGwzRv72H0gaZsRbamEjnoDY7hiRRa3I9fMDq1j42do+wtn0QxeeVzT2s7xxiLBtkXLIxpi2JYob8zXdaGxhjo7PSFv9FLFmIEtW4htIa3k96w0CGOeciUFsP2TR4yXO8vr3jqxAQ5QiFEChEGWcQgaYtlUtzzndlMij1TrdmDP4sBIqyihCGMZhh/D8CpdEIFDpg6l+abCBCLRsgWDx+EJbOCMvnhLwkGEtdf7uSIzBl5f3UIKg14rUy7TrNi3QfgcqaLqvZDH+ASilY6+IZCFMbkDTJUKvO5e+6JPGAfvd0UXBCGVN9WpkFYiN+zJr/xkcGt+UbiqBViTnZHW0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"docker-images\"\n        title=\"docker-images\"\n        src=\"/static/280337045f286628fabbd9ea92b3b958/906b5/750-docker-images.png\"\n        srcset=\"/static/280337045f286628fabbd9ea92b3b958/5ea4d/750-docker-images.png 238w,\n/static/280337045f286628fabbd9ea92b3b958/466da/750-docker-images.png 475w,\n/static/280337045f286628fabbd9ea92b3b958/906b5/750-docker-images.png 950w,\n/static/280337045f286628fabbd9ea92b3b958/9cea8/750-docker-images.png 1278w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<h2>8. 운영서버에서 자동으로 서비스하기</h2>\n<p>이제 생성된 이미지로 컨테이너를 시작하면 된다. 나는 이 과정이 빌드 후 자동으로 실행되도록 할것이다.</p>\n<h3>8.1 운영서버 EC2 생성하기</h3>\n<p>운영서버를 위한 EC2 를 생성하고 <a href=\"#2.-CI/CD-%EC%84%9C%EB%B2%84%EC%97%90-jenkins-%EC%84%A4%EC%B9%98\">2.</a> 과 동일하게 도커 패키지를 설치한다.\r\n이후 서비스를 위한 웹 서비스를 위한 80, 443 포트를 열어준다.</p>\n<p>추가로 22포트로 접근 가능하도록 열어줘야 한다. 이유는 다음과 같다.</p>\n<h3>8.2 젠킨스에서 플러그인 설치</h3>\n<p>젠킨스 서버에서 SSH 로 운영서버에 접속해 서비스를 실행하기 때문에 관련 플러그인을 설치해야 한다.<br>\n아래 사진처럼 Publish Over SSH 를 설치한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/356b39bbd5387308395237bcb4efa62b/84f4d/820-publish-over-ssh.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABdElEQVQoz3VTXY/cIAzc///j+nQv7UOl6k7ZbPhYwIAhCZkKc7vaay+WRsYET2w8XLwPcM4j5wyiCC4F+75L7JxDCAEpJRARMheEVJC4yt66rnL2gR5fcGLcCe8WwXvEGOG9R8qMEAtirrLXCVprT2zbhstxHPgX3ZwPsD4OgpRRS0EpRXwHM0sXWmvpose9i1PCQBF/3id8TDdc55skGmOwLApKKam8risSl5FzHHINX1oehGNNxuH6sUBfFby2yPc72Dnx2Vq0nAV2MeKRM5Jz3xDKooEWjWnSWGaN6AnY9/9QUsKPt19oXIA+PGO+q/CzZUeYJiNQNw2nFMjewd6DQ0AJATkQ3n7+xs4MpIwUwjkh5YrZRMw2wnoCxSSSGqjD1xXvi0XrOa2NOzwbCkXGtHjMOkCZocfHt9cCOvnpUF6tEypLInrTW2V+SqUn1lqxtwZHSTT4rPBVmK+otciBB0HOSXxHF3Unf7yObRsvpf/kL1OIWJhi4IHEAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"publish-over-ssh\"\n        title=\"publish-over-ssh\"\n        src=\"/static/356b39bbd5387308395237bcb4efa62b/906b5/820-publish-over-ssh.png\"\n        srcset=\"/static/356b39bbd5387308395237bcb4efa62b/5ea4d/820-publish-over-ssh.png 238w,\n/static/356b39bbd5387308395237bcb4efa62b/466da/820-publish-over-ssh.png 475w,\n/static/356b39bbd5387308395237bcb4efa62b/906b5/820-publish-over-ssh.png 950w,\n/static/356b39bbd5387308395237bcb4efa62b/84f4d/820-publish-over-ssh.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Publish Over SSH 은 젠킨스에서 원격서버에 접속할 수 있는 플러그인이다.<br>\n공식 문서(<a href=\"https://plugins.jenkins.io/publish-over-ssh/\">https://plugins.jenkins.io/publish-over-ssh/</a>) 를 대충 번역하자면<br>\nSSH 를 통한 파일 전송, 원격 서버에서 명령 실행, username/password 와 공용 키를 사용한 인증 등 여러 기능을 제공한다.</p>\n<h3>8.3 운영서버 SSH 접속정보 등록<a id='8.3-운영서버-SSH-접속정보-등록'></a></h3>\n<p>이 플러그인을 사용하기 위해 운영서버의 SSH 접속정보를 젠킨스에 등록해야 한다.\r\n젠킨스 관리 - 시스템 설정(<code class=\"language-text\">[젠킨스 서버 IP]:8080/configure</code>) 으로 이동해서 Publish over SSH 부분을 채워준다.</p>\n<p>각 항목을 설명하자면 다음과 같다</p>\n<ul>\n<li><code class=\"language-text\">Passphrase</code> : 개인 키가 암호화 되어 있을 경우 암호를 적는다.</li>\n<li><code class=\"language-text\">Path to key</code> : 개인 키가 젠킨스 서버에 있을 경우 경로를 적는다.</li>\n<li><code class=\"language-text\">Key</code> : 개인키 파일의 내용을 입력한다.</li>\n<li><code class=\"language-text\">SSH Servers</code> : 원격서버의 정보를 입력한다.\n<ul>\n<li><code class=\"language-text\">Name</code> : 원격서버 설정에 대한 이름이다.</li>\n<li><code class=\"language-text\">Hostname</code> : 원격서버의 호스트명이다. hostname 또는 IP 를 입력한다.</li>\n<li><code class=\"language-text\">Username</code> : 원격서버에 접속하기 위한 유저 이름이다.</li>\n<li><code class=\"language-text\">Remote Directory</code> : 이 설정의 기본 디렉토리. 반드시 존재하는 디렉토리여야 하며, 이 디렉토리 내에만 파일을 전송할 수 있다.</li>\n</ul>\n</li>\n</ul>\n<p>나는 아래 사진처럼 등록했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9306686b0ebfc7381b70ddc51b125698/84f4d/830-0-private-key.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABZklEQVQoz32RPUsDQRBAD4RoYycIirX/xtYfoH/NxsZCEXvBD1BJSGGwsNOLMSbh9rzPnXkydzkT5XTgMcfu7LuZ3eAzSUiShDRNSdMM732FiyImkwl5ntdrZfm9t0zpPU1YTcAfMXofM53NEFVEDFlC8V4qoapy9/jM2VWXaRQT2EIbk+mM8fgD5xxR5OrsFrmZKssybvpPnF7e8zGL2oUWVujmgjZMWNfERC4jzz3i/c+RG5nlOHKkcQwireh8XMOLUHqh/H2Hy8JUlRL+x0Rl/TAVrUL7K5AMBiTXV3ze3lI8PKC9HtLQ7SL9PlIU80eTutPWkW3Tvvf30SBA1tbQTgc6nSrr6iq6soJubKDDYV1r1wDkRfGPcG8PguAb/Y2Jw/CHMM2yv4X+4BBdX4edHXRra8H2Nmxuoru76GhU1VZnlPaRm4c5Oj7n4uQCfX1BXsO6m+EQbMwwhLc3M9Qdzs+Y8Aue/ipsMRWrmwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"private-key\"\n        title=\"private-key\"\n        src=\"/static/9306686b0ebfc7381b70ddc51b125698/906b5/830-0-private-key.png\"\n        srcset=\"/static/9306686b0ebfc7381b70ddc51b125698/5ea4d/830-0-private-key.png 238w,\n/static/9306686b0ebfc7381b70ddc51b125698/466da/830-0-private-key.png 475w,\n/static/9306686b0ebfc7381b70ddc51b125698/906b5/830-0-private-key.png 950w,\n/static/9306686b0ebfc7381b70ddc51b125698/84f4d/830-0-private-key.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f0e3d787c1b02ea8208af35e3c9f0cba/84f4d/830-1-remote-server.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 55.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA8klEQVQoz42SzWrFIBBG8/6v0Xdon+DexV11202hUGhX0RjU6KinmB+40Jhk4GNwlON8w3TWOZxzeO/xfiKlhIhgjJnr27nmptb7EAIdjRjHkUFrKIVySczQbu+yRhBhiIIPceki51NVJ22gUpjHA9EDGU6hueba4bPNZ2Dse+z9jihF2oCHWjtsAavlsf56CXYFGAJaKZx15/NbxyGHlmOkVwprLTmXuYP92ZVFpSCyA9xykvpgWYejdclZmCaLMQMSQwsIWnuU8qylf7HV9dDz8fXL5/cPZujbll/ebrze3ikpzZZa65WS4KeJEANh8vwBs5FiZsWI3ukAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"remote-server\"\n        title=\"remote-server\"\n        src=\"/static/f0e3d787c1b02ea8208af35e3c9f0cba/906b5/830-1-remote-server.png\"\n        srcset=\"/static/f0e3d787c1b02ea8208af35e3c9f0cba/5ea4d/830-1-remote-server.png 238w,\n/static/f0e3d787c1b02ea8208af35e3c9f0cba/466da/830-1-remote-server.png 475w,\n/static/f0e3d787c1b02ea8208af35e3c9f0cba/906b5/830-1-remote-server.png 950w,\n/static/f0e3d787c1b02ea8208af35e3c9f0cba/84f4d/830-1-remote-server.png 1208w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>정보 입력 후 Test Configuration 버튼(주황색 상자)을 누르면 현재 SSH 정보로 원격서버에 연결하여 테스트 할 수 있다.<br>\n정상적이라면 파란색 상자 안에 보이는 것처럼 <code class=\"language-text\">Success</code> 라는 문자열을 출력한다.</p>\n<h3>8.4 서비스 컨테이너 시작을 위한 설정파일 생성</h3>\n<p>젠킨스에서 빌드가 끝나면 <code class=\"language-text\">docker-compose.yml</code> 파일을 기반으로 <code class=\"language-text\">docker-compose</code> 명령어를 실행하여 컨테이너를 시작하게 된다.<br>\n이를 위한 설정파일들을 Job 의 홈 디렉토리에 생성해야 한다.<br>\n젠킨스 서버에서 직접 볼륨에 생성해도 되고, 컨테이너 쉘을 열어 생성해도 된다.\r\n나는 컨테이너 쉘을 열어 작업했다. 그리고 설정파일들을 위한 디렉토리를 추가로 만들어줬다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> <span class=\"token builtin class-name\">exec</span> -it jenkins_cicd /bin/bash\r\n\r\n<span class=\"token builtin class-name\">cd</span> /var/jenkins_home/workspace/django-ci-cd\r\n<span class=\"token function\">mkdir</span> deploy</code></pre></div>\n<h4>8.4.1 docker-compose.yml</h4>\n<p>이 파일은 실제 서비스를 가지고 있는 컨테이너를 생성하기 위한 설정파일이다. 아래의 경로에 생성한다.\r\n<code class=\"language-text\">/var/jenkins_home/workspace/django-ci-cd/deploy/</code></p>\n<div class=\"gatsby-highlight\" data-language=\"dockerfile\"><pre class=\"language-dockerfile\"><code class=\"language-dockerfile\"><span class=\"token comment\"># docker-compose.yml</span>\r\n\r\nversion: \"2\"\r\n\r\nservices:\r\n  nginx:\r\n    image: nginx:latest\r\n    container_name: nginx\r\n    ports:\r\n      - \"80:80/tcp\"\r\n    volumes:\r\n      <span class=\"token comment\"># nginx 설정파일</span>\r\n      - ./nginx:/etc/nginx/conf.d\r\n\r\n      <span class=\"token comment\"># static 디렉토리. 장고 프로젝트 소스의 static 디렉토리를 사용한다</span>\r\n      - ../static:/static\r\n    depends_on:\r\n      - django_web\r\n  \r\n  django_web:\r\n    <span class=\"token comment\"># docker hub 의 최신 이미지</span>\r\n    image: ohyunkyo/inventory:latest\r\n    container_name: django_web\r\n\r\n    <span class=\"token comment\"># gunicorn를 사용. 8000 포트. 특정 설정 파일로 실행</span>\r\n    command: gunicorn --bind 0.0.0.0:8000 --env DJANGO_SETTINGS_MODULE=config.settings.prod config.wsgi:application\r\n    volumes:\r\n      <span class=\"token comment\"># static 디렉토리</span>\r\n      - ../static:/usr/src/app/static\r\n    expose: \r\n      - \"8000\"\r\n    secrets:\r\n      <span class=\"token comment\"># 보안파일</span>\r\n      - django_secret\r\n\r\nsecrets:\r\n    django_secret:\r\n        file: django_secret.json</code></pre></div>\n<blockquote>\n<p>여기서 config 는 내 프로젝트 이름이다. 처음 장고를 배운 책에서 나온 과정을 그대로 따라해서 생긴 프로젝트 이름인데 나중에 프로젝트 이름을 변경할 생각이다.</p>\n</blockquote>\n<h4>8.4.2 nginx.conf</h4>\n<p>장고 프로젝트로 연결하기 위한 설정파일이다. 아래의 경로에 생성한다.\r\n<code class=\"language-text\">/var/jenkins_home/workspace/django-ci-cd/deploy/nginx/</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># nginx.conf\r\n\r\nupstream django_web {\r\n    ip_hash;\r\n    server django_web:8000;\r\n}\r\nserver {\r\n    location / {\r\n        proxy_pass http://django_web/;\r\n        proxy_redirect     off;\r\n        proxy_set_header   Host $host;\r\n        proxy_set_header   X-Real-IP $remote_addr;\r\n        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;          \r\n    }\r\n    location /static {\r\n        alias /static/;\r\n    }\r\n    listen 80;\r\n    server_name localhost;\r\n}</code></pre></div>\n<h4>8.4.3 디렉토리 구조 확인</h4>\n<p>마지막으로 젠킨스 컨테이너의 디렉토리 구조를 살펴보자면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">/\r\n├── var\r\n    ├── jenkins_home\r\n        ├── workspace\r\n            ├── django-ci-cd\r\n                ├── .git\r\n                ├── .gitignore\r\n                ├── Dockerfile\r\n                ├── README.md\r\n                ├── common\r\n                ├── config\r\n                ├── deploy\r\n                    ├── docker-compose.yml\r\n                    ├── django_secret.json\r\n                    ├── nginx\r\n                        ├── nginx.conf                \r\n                ├── inventory\r\n                ├── manage.py\r\n                ├── requirements.txt\r\n                ├── static\r\n                ├── utils</code></pre></div>\n<h3>8.5 젠킨스 빌드 설정</h3>\n<p>이제 실제로 설정파일을 운영서버로 전송한 후 컨테이너를 생성, 시작하여 서비스를 실행해야 한다.</p>\n<p>젠킨스 Job 설정 - 빌드 후 조치 탭에서 <code class=\"language-text\">Send build artifacts over SSH</code> 를 선택하여 빌드 후 조치 프로세스를 하나 추가한다.</p>\n<p>난 아래 사진처럼 설정했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 894px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3287188cc1b3804fd91b6f2bfdcba74/38af3/850-ssh-publish.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.98319327731092%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJklEQVQ4y6WVzY7TMBSF+3qIx4GXgNeZPSxmOVQCViPEhmljN7ETJ7ETO07ag+7NTwulkBkqfWqTWsf351x787TbQ+ucyfMCP552SIREURhY5+AmrB1pmuYaN74PIWCTphm01siUYkGlNLJMoSgKfmeMYcqyRFlVsNZe4bzn72EYsEmSBIT3HjFGdF3HO/0Ovf/Tf75t0UiJ4D2OxyM2QiQQQjAHeUCe5zdFr+g6eGthHh5YeBIU2O12nBbv6P06sQvR7niED2EU1FpBSnkzpVV4z4GwIBWbGlHVNdp2rmNEF1fQxWV9O6dMIdMDWeKyMWugtd4HOLbPJEgiJBjj81Om9c41KEx5jpCakabpy2p3YaelhmRIkSQgg7+4KZM7WJBGJs0U+49qwQ3hXeMKxnUhdOeUSZDmllKn2eUFFOlK5qwWQecslFI8t44Fn5v2LDilTA6noaaH2Pfr/HcBWWe23tSUGkkisN/vobT+/6bQD1NWo+svIowhILJ5e47iNj1H2Jyb4vjs03nOTYmToAdGaE45gr/hL33o+HBIhGDrGDpItcZwf4/h8REDgL7vbzMMHOVSQ5wGlLnGQUquo5ASJs3g7+4QtlsW/NeHhBbBj9uv+PDpM6TOUNYGlS3h2gb2dILte74r5pSaNqD1AQ3RBvgwHhC/+PDVm3d4/fY9vnz7jqoyLGpMgYrukek+me+ULLdQhYMqLNLcorItamtR1Xap4U907KVBrT48wAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ssh-publish\"\n        title=\"ssh-publish\"\n        src=\"/static/c3287188cc1b3804fd91b6f2bfdcba74/38af3/850-ssh-publish.png\"\n        srcset=\"/static/c3287188cc1b3804fd91b6f2bfdcba74/5ea4d/850-ssh-publish.png 238w,\n/static/c3287188cc1b3804fd91b6f2bfdcba74/466da/850-ssh-publish.png 475w,\n/static/c3287188cc1b3804fd91b6f2bfdcba74/38af3/850-ssh-publish.png 894w\"\n        sizes=\"(max-width: 894px) 100vw, 894px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>해당 프로세스의 각 항목을 설명하자면 다음과 같다.</p>\n<ul>\n<li><code class=\"language-text\">Name</code> :  <a href=\"#8.3-%EC%9A%B4%EC%98%81%EC%84%9C%EB%B2%84-SSH-%EC%A0%91%EC%86%8D%EC%A0%95%EB%B3%B4-%EB%93%B1%EB%A1%9D\">8.3</a> 에서 등록한 원격서버를 선택한다.</li>\n<li><code class=\"language-text\">Transfer Set</code>\n<ul>\n<li><code class=\"language-text\">Source files</code> : 원격서버로 전송할 파일 또는 디렉토리를 입력한다. 배포설정이 있는 디렉토리와 <code class=\"language-text\">python manage.py collectstatic</code> 명령어로 생성된 <code class=\"language-text\">static</code> 디렉토리를 포함시켰다.\n<ul>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">deploy/**, static/**</code></pre></div>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">Remove prefix</code> : 전송시 생략될 디렉토리 이름을 입력한다. 그대로 보낼것이기 때문에 비워둔다.</li>\n<li><code class=\"language-text\">Remote directory</code> : 원격디렉토리. 원격서버의 이 디렉토리에 파일이 전송된다.\n<ul>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">deploys</code></pre></div>\n</li>\n</ul>\n</li>\n<li><code class=\"language-text\">Exec command</code> : 원격서버에서 실행될 명령어. 파일이 전송된 디렉토리로 들어가서 도커 이미지를 가져오고 빌드한다. 내가 사용할 저장소는 private 저장소이기 때문에 로그인 하는 과정이 꼭 필요한다.\n<ul>\n<li>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token builtin class-name\">cd</span> /home/ec2-user/deploys/deploy\r\n<span class=\"token function\">sudo</span> <span class=\"token function\">docker</span> login -u ohyunkyo -p <span class=\"token string\">'test!@#$'</span>\r\n<span class=\"token function\">sudo</span> <span class=\"token function\">docker-compose</span> pull\r\n<span class=\"token function\">sudo</span> <span class=\"token function\">docker-compose</span> up --force-recreate --build -d</code></pre></div>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3>8.6 빌드하기</h3>\n<p>이제 빌드하면 운영서버에 <code class=\"language-text\">nginx</code> 와 <code class=\"language-text\">django_web</code> 라는 이름을 가진 컨테이너가 생성된다. 또한 서비스도 정상적으로 실행되었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 950px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b6c699a7fdcfaffa5ed3385d973763a1/18539/860-0-containers-list.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 5.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAR0lEQVQI1x3KMQrAIAxA0UiKRtA4OOhSIb3/HX9p5/ckImitISLMOYkn6L0zhuPufK6qSErc51DN/rv3Zq1FKQXVi5wzVo0XphkXRaCwErIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"containers-list\"\n        title=\"containers-list\"\n        src=\"/static/b6c699a7fdcfaffa5ed3385d973763a1/906b5/860-0-containers-list.png\"\n        srcset=\"/static/b6c699a7fdcfaffa5ed3385d973763a1/5ea4d/860-0-containers-list.png 238w,\n/static/b6c699a7fdcfaffa5ed3385d973763a1/466da/860-0-containers-list.png 475w,\n/static/b6c699a7fdcfaffa5ed3385d973763a1/906b5/860-0-containers-list.png 950w,\n/static/b6c699a7fdcfaffa5ed3385d973763a1/18539/860-0-containers-list.png 1074w\"\n        sizes=\"(max-width: 950px) 100vw, 950px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 792px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7e52be5d08d005bc2cfcd55a7af6cfc5/9a86a/860-1-django-web.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.0420168067227%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC2UlEQVQ4y52UW4scRRSAG0ISyEt+wLJCJJBNQCUIguZfCb7l1Rd1d72A70Zf3Z0rwQcRkbyIeMVNdsIkxtnJ9Fy3u6enqrqquj6p6pll3U2y0YaPU8NUfXU43edEb165wq0bN3hnY4O3r13j1sZ13rp6ldfW1nh9bS3Es3hj/RVevXyZ92/fJmq02+zu7FCr1/m6Vjtit9Gg1myy22yGeJJGu0Wz3aLRqmK91eSHe/eI8I82/NfH+WOuWuuyimmaEsWDAfv7HbrdbuDx40d0Oh3u339Ar/eEXq+HMRZrDMYYrK3ip3f3eO+rn7jz/UPe/eJHttp7xHFMJIRgNBwzmUwZjydkWU6SpCRJRppm4XdR6FM8nc75K04ZHuZVTASj0YioKAqms4TZLEEIRVGYgFL6CCnVMYoQTaGx2qALHdaUrhIuFgs6D7v8/eSAwWDMQX9Evz9ikc6RWY7IcuQ8R4qVrMJfvhCqiguJ1rYSKqmIhxNGFjJfWGAOiJMUJkjFMelx+ZHQ2BKZC8ydLzEffIjZ/hiztY3e3EJvbqM/2kRvf4J8GiO0PZXpaWFZIg5TyvV1iKLnon7+JWQqF/JsYe6FN2+Gg+7iRdz58xUXLuDOncNduoT67Q+Eq4RiWTuxzPaE0CGSjHLj+osz/PX3I+GzMvTfahBqY8nnC9S336F2aqh6E1VvLGmiag1Uo4UYTxFKI05keOotl2UZ7L75XoR1Dus7xpZYu4yrs8aG1gtC35XOOfBYizPm2ZRl2BcioNIMeTjDN0aWZRhrGI/HRFr7TpDMZrPQckqpl0PKgD+b5zneU9VQ63BDv99nOp2GG18aXSCVIpvnqKKohL4ewzgOU+UwScIk8XWt6vR8VnuqQQbOGobDZYa+n/3U8amv1mfh95lCsX8w4fNv9ugOEmYT/x0aE/5ciVbrs8iDUPKgN+Gzu3/yKE6YZwlReHP/k7J0/5riQkr+AWZX4mZj+XW4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"django-web\"\n        title=\"django-web\"\n        src=\"/static/7e52be5d08d005bc2cfcd55a7af6cfc5/9a86a/860-1-django-web.png\"\n        srcset=\"/static/7e52be5d08d005bc2cfcd55a7af6cfc5/5ea4d/860-1-django-web.png 238w,\n/static/7e52be5d08d005bc2cfcd55a7af6cfc5/466da/860-1-django-web.png 475w,\n/static/7e52be5d08d005bc2cfcd55a7af6cfc5/9a86a/860-1-django-web.png 792w\"\n        sizes=\"(max-width: 792px) 100vw, 792px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>","frontmatter":{"title":"젠킨스를 사용한 장고 배포 OLD","date":"May 02, 2022","description":null},"fields":{"category":"devops","slug":"/devops/deploy-django-with-jenkins-old/"}},"previous":{"fields":{"slug":"/gatsby/make-blog-with-gatsby/"},"frontmatter":{"title":"gatsby 를 사용하여 블로그 만들기"}},"next":{"fields":{"slug":"/devops/jenkins-notice-to-telegram-with-notify-events/"},"frontmatter":{"title":"notify.events 를 통해 텔레그램으로 젠킨스 알림 받기"}}},"pageContext":{"id":"67f66c8b-afe1-5ff4-9c6e-84043895887f","previousPostId":"0356b0d3-8fc2-585e-9fd0-b2611b6b1dce","nextPostId":"421de7eb-2f6f-5f97-89b4-d69916040439"}},
    "staticQueryHashes": ["230163734","2841359383","3496359572"]}